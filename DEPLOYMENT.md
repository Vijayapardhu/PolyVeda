# PolyVeda Deployment Guide for Render

This guide provides comprehensive instructions for deploying PolyVeda on Render, a modern cloud platform for hosting web applications.

## ðŸš€ Quick Start

### 1. Prerequisites

- [Render Account](https://render.com) (Free tier available)
- [GitHub Repository](https://github.com) with your PolyVeda code
- [PostgreSQL Database](https://www.postgresql.org/) (provided by Render)
- [Redis Cache](https://redis.io/) (provided by Render)

### 2. Deployment Steps

#### Step 1: Connect Your Repository

1. Log in to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" and select "Blueprint"
3. Connect your GitHub repository
4. Select the repository containing PolyVeda

#### Step 2: Configure Services

The `render.yaml` file will automatically create:
- **Web Service**: Main Django application
- **PostgreSQL Database**: Primary database
- **Redis Service**: Caching and message broker
- **Worker Service**: Background task processing
- **Beat Service**: Scheduled task management

#### Step 3: Set Environment Variables

Configure these environment variables in Render Dashboard:

**Required Variables:**
```bash
DJANGO_SETTINGS_MODULE=polyveda.settings.production
SECRET_KEY=<auto-generated>
DATABASE_URL=<auto-provided>
REDIS_URL=<auto-provided>
DEBUG=false
ALLOWED_HOSTS=.onrender.com
CSRF_TRUSTED_ORIGINS=https://your-app-name.onrender.com
```

**Optional Variables:**
```bash
# Email Configuration
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# AWS S3 (for file storage)
AWS_ACCESS_KEY_ID=your-aws-key
AWS_SECRET_ACCESS_KEY=your-aws-secret
AWS_STORAGE_BUCKET_NAME=your-bucket-name

# Monitoring
SENTRY_DSN=your-sentry-dsn

# Blockchain (optional)
BLOCKCHAIN_RPC_URL=your-rpc-url
BLOCKCHAIN_CONTRACT_ADDRESS=your-contract-address
BLOCKCHAIN_PRIVATE_KEY=your-private-key
```

#### Step 4: Deploy

1. Click "Create Blueprint Instance"
2. Render will automatically:
   - Build the application
   - Run database migrations
   - Collect static files
   - Start all services

## ðŸ“‹ Configuration Details

### Database Configuration

The PostgreSQL database is automatically configured with:
- **Connection Pooling**: Optimized for Django
- **SSL**: Secure connections enabled
- **Backup**: Automatic daily backups
- **Scaling**: Can be upgraded as needed

### Redis Configuration

Redis is configured for:
- **Caching**: Session storage and query caching
- **Message Broker**: Celery task queue
- **Rate Limiting**: API request throttling
- **Real-time Features**: WebSocket support

### Static Files

Static files are served using:
- **Whitenoise**: Efficient static file serving
- **Compression**: Gzip compression enabled
- **Caching**: Long-term caching headers
- **CDN Ready**: Can be moved to CDN later

## ðŸ”§ Advanced Configuration

### Custom Domain

1. Go to your web service settings
2. Click "Custom Domains"
3. Add your domain
4. Update DNS records as instructed
5. Update `ALLOWED_HOSTS` and `CSRF_TRUSTED_ORIGINS`

### SSL Certificate

SSL certificates are automatically provisioned by Render for:
- `*.onrender.com` domains
- Custom domains (requires DNS configuration)

### Environment-Specific Settings

Create environment-specific settings files:

```python
# settings/staging.py
from .production import *

DEBUG = True
ALLOWED_HOSTS = ['staging-polyveda.onrender.com']
```

## ðŸ“Š Monitoring and Health Checks

### Health Check Endpoints

- **Health Check**: `https://your-app.onrender.com/health/`
- **System Status**: `https://your-app.onrender.com/status/`
- **API Status**: `https://your-app.onrender.com/api-status/`
- **Metrics**: `https://your-app.onrender.com/metrics/`

### Logs and Monitoring

1. **Application Logs**: Available in Render Dashboard
2. **Database Logs**: PostgreSQL logs in database service
3. **Redis Logs**: Redis service logs
4. **Worker Logs**: Background task logs

### Performance Monitoring

Monitor these metrics:
- **Response Time**: API endpoint performance
- **Database Queries**: Query performance and optimization
- **Memory Usage**: Application memory consumption
- **CPU Usage**: Server resource utilization
- **Error Rates**: Application error tracking

## ðŸ”’ Security Configuration

### Security Headers

The application includes:
- **HSTS**: HTTP Strict Transport Security
- **CSP**: Content Security Policy
- **XSS Protection**: Cross-site scripting protection
- **CSRF Protection**: Cross-site request forgery protection

### Authentication

- **JWT Tokens**: Secure API authentication
- **2FA Support**: Two-factor authentication
- **Session Management**: Secure session handling
- **Rate Limiting**: API request throttling

### Data Protection

- **Encryption**: Data encryption at rest and in transit
- **Backup**: Regular automated backups
- **Compliance**: GDPR and FERPA compliance features
- **Audit Logging**: Comprehensive activity logging

## ðŸš¨ Troubleshooting

### Common Issues

#### 1. Build Failures

**Problem**: Build process fails
**Solution**:
```bash
# Check build logs in Render Dashboard
# Verify requirements.txt is up to date
# Ensure all dependencies are compatible
```

#### 2. Database Connection Issues

**Problem**: Cannot connect to database
**Solution**:
```bash
# Verify DATABASE_URL is set correctly
# Check database service is running
# Ensure migrations are applied
```

#### 3. Static Files Not Loading

**Problem**: CSS/JS files not loading
**Solution**:
```bash
# Run collectstatic command
python manage.py collectstatic --noinput

# Check STATIC_ROOT configuration
# Verify Whitenoise is configured
```

#### 4. Background Tasks Not Working

**Problem**: Celery tasks not executing
**Solution**:
```bash
# Check Redis connection
# Verify worker service is running
# Check task queue configuration
```

### Debug Commands

```bash
# Check application status
curl https://your-app.onrender.com/health/

# Test database connection
python manage.py dbshell

# Check Redis connection
python manage.py shell -c "from django.core.cache import cache; cache.set('test', 'ok')"

# View application logs
# Check Render Dashboard > Logs
```

### Performance Optimization

1. **Database Optimization**:
   ```sql
   -- Add indexes for frequently queried fields
   CREATE INDEX idx_user_email ON users(email);
   CREATE INDEX idx_audit_timestamp ON audit_logs(timestamp);
   ```

2. **Caching Strategy**:
   ```python
   # Cache frequently accessed data
   from django.core.cache import cache
   
   def get_user_permissions(user_id):
       cache_key = f"user_permissions_{user_id}"
       permissions = cache.get(cache_key)
       if not permissions:
           permissions = User.objects.get(id=user_id).get_permissions()
           cache.set(cache_key, permissions, 300)  # 5 minutes
       return permissions
   ```

3. **Static File Optimization**:
   ```python
   # Enable compression
   STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
   ```

## ðŸ“ˆ Scaling

### Vertical Scaling

1. **Upgrade Service Plans**:
   - Web Service: Free â†’ Starter â†’ Standard
   - Database: Free â†’ Starter â†’ Standard
   - Redis: Free â†’ Starter â†’ Standard

2. **Resource Allocation**:
   - Increase CPU and memory allocation
   - Optimize database connection pooling
   - Configure worker concurrency

### Horizontal Scaling

1. **Load Balancing**:
   - Multiple web service instances
   - Database read replicas
   - Redis clustering

2. **Microservices**:
   - Separate API and frontend services
   - Dedicated worker services
   - Specialized background task queues

## ðŸ”„ CI/CD Integration

### GitHub Actions

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Render

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Render
        uses: johnbeynon/render-deploy-action@v1.0.0
        with:
          service-id: ${{ secrets.RENDER_SERVICE_ID }}
          api-key: ${{ secrets.RENDER_API_KEY }}
```

### Automated Testing

```yaml
name: Test and Deploy

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.11
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: python manage.py test
      - name: Run linting
        run: flake8 .
```

## ðŸ“ž Support

### Render Support

- **Documentation**: [Render Docs](https://render.com/docs)
- **Community**: [Render Community](https://community.render.com)
- **Status**: [Render Status](https://status.render.com)

### PolyVeda Support

- **Documentation**: [PolyVeda Docs](https://polyveda.com/docs)
- **Issues**: [GitHub Issues](https://github.com/your-repo/issues)
- **Discussions**: [GitHub Discussions](https://github.com/your-repo/discussions)

## ðŸŽ¯ Best Practices

### Development Workflow

1. **Local Development**:
   ```bash
   # Use Docker for local development
   docker-compose up -d
   
   # Run tests locally
   python manage.py test
   
   # Check code quality
   flake8 .
   black .
   ```

2. **Staging Environment**:
   - Deploy to staging before production
   - Test all features thoroughly
   - Verify database migrations

3. **Production Deployment**:
   - Use blue-green deployment
   - Monitor application health
   - Backup database before major changes

### Security Best Practices

1. **Environment Variables**:
   - Never commit secrets to version control
   - Use Render's environment variable management
   - Rotate secrets regularly

2. **Database Security**:
   - Use connection pooling
   - Enable SSL connections
   - Regular security updates

3. **Application Security**:
   - Keep dependencies updated
   - Enable security headers
   - Monitor for vulnerabilities

### Performance Best Practices

1. **Database Optimization**:
   - Use database indexes
   - Optimize queries
   - Monitor slow queries

2. **Caching Strategy**:
   - Cache frequently accessed data
   - Use Redis for session storage
   - Implement CDN for static files

3. **Background Tasks**:
   - Use Celery for long-running tasks
   - Monitor task queues
   - Handle task failures gracefully

## ðŸŽ‰ Success Metrics

Monitor these metrics for successful deployment:

- **Uptime**: > 99.9%
- **Response Time**: < 200ms
- **Error Rate**: < 0.1%
- **Database Performance**: < 100ms queries
- **User Satisfaction**: > 4.5/5

---

**Happy Deploying! ðŸš€**

For additional support, please refer to the [PolyVeda Documentation](https://polyveda.com/docs) or create an issue in the [GitHub Repository](https://github.com/your-repo/issues).